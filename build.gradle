import com.bmuschko.gradle.docker.tasks.image.*

plugins {
    id 'java'
    id 'application'
    id 'org.springframework.boot' version '2.1.3.RELEASE'
    id 'com.bmuschko.docker-remote-api' version '4.6.1'
//    id 'com.bmuschko.docker-java-application' version '4.6.1'
//    id 'com.bmuschko.docker-spring-boot-application' version '4.6.1'
}


repositories {
    mavenLocal()
    jcenter()
    mavenCentral()
}

group = 'com.github.dddpaul'
version = '2.1.1.RELEASE'
sourceCompatibility = JavaVersion.VERSION_1_8

mainClassName = 'org.springframework.cloud.config.server.ConfigServerApplication'

application {
    mainClassName = 'org.springframework.cloud.config.server.ConfigServerApplication'
}

bootJar {
    mainClassName = 'org.springframework.cloud.config.server.ConfigServerApplication'
}

dockerCreateDockerfile {
    mainClassName = 'org.springframework.cloud.config.server.ConfigServerApplication'
}

//task createDockerfile(type: Dockerfile) {
//    dependsOn shadowJar
//    destFile = project.file("${project.buildDir}/Dockerfile")
//    from 'openjdk:10-jre'
//    addFile "libs/${project.name}-${project.version}-all.jar", '/app.jar'
//    entryPoint 'java', '-Djava.security.egd=file:/dev/./urandom', '-jar', '/app.jar'
//}



docker {
    springBootApplication {
        baseImage = 'openjdk:8-alpine'
        ports = [8888]
        tag = "dddpaul/${project.name}:${project.version}"
    }
}

dependencies {
    compile 'org.springframework.cloud:spring-cloud-config-server:2.1.1.RELEASE'
}

wrapper {
    gradleVersion = '5.2.1'
    distributionUrl = 'https://services.gradle.org/distributions/gradle-5.2.1-bin.zip'
}
